---
title: "R Notebook"
output: html_notebook
---

# TITLE

## Librarys

```{r Librarys}
#install.packages("tidyverse")
#install.packages("patchwork")
install.packages("ggpubr")
```

```{r}
library(tidyverse)
library(patchwork)
library(reshape2)
library(ggpubr)
```

## Getting data

```{r}
dir <- "Fitabase Data 4.12.16-5.12.16"

daily_activity <- read.csv(file.path(dir, "dailyActivity_merged.csv"))
daily_calories <- read.csv(file.path(dir, "dailyCalories_merged.csv"))
daily_intensities <- read.csv(file.path(dir, "dailyIntensities_merged.csv"))
daily_steps <- read.csv(file.path(dir, "dailySteps_merged.csv"))
```

```{r}
str(daily_activity)
```

```{r}
str(daily_calories)
```

```{r}
str(daily_intensities)
```

```{r}
str(daily_steps)
```

It seems as some of the data is repeated, so we will be using daily_activities because it is more complete.

Let' see the summary of the data:

```{r}
print("Activity general")
daily_activity %>%  
  select(TotalSteps,
         TotalDistance,
         SedentaryMinutes, Calories) %>%
  summary()

print("Active distance")
daily_activity %>%  
  select(VeryActiveDistance,
         ModeratelyActiveDistance,
         LightActiveDistance,
         SedentaryActiveDistance) %>%
  summary()

print("Active minutes")
daily_activity %>%  
  select(VeryActiveMinutes,
         FairlyActiveMinutes,
         LightlyActiveMinutes,
         SedentaryMinutes) %>%
  summary()

```

Let's analyze more available data

```{r}
sleep <- read.csv(file.path(dir, "sleepDay_merged.csv"))
weight <- read.csv(file.path(dir, "weightLogInfo_merged.csv"))


# heart_rate <- read.csv(file.path(dir, "heartrate_seconds_merged.csv"))

hourly_calories <- read.csv(file.path(dir, "hourlyCalories_merged.csv"))
hourly_intensities <- read.csv(file.path(dir, "hourlyIntensities_merged.csv"))
```

```{r}
print("Sleep:")
colnames(sleep)
print("Weight:")
colnames(weight)
#print("Heart_rate:")
#colnames(heart_rate)
print("Hourly_calories:")
colnames(hourly_calories)
print("Hourly_intensities:")
colnames(hourly_intensities)
```

This data is very large and does not provide many insights. 

steps_narrow <- read.csv(file.path(dir, "minuteStepsNarrow_merged.csv")) 
steps_wide <- read.csv(file.path(dir, "minuteStepsWide_merged.csv")) 
minutes_calories_narrow <- read.csv(file.path(dir, "minuteCaloriesNarrow_merged.csv"))

```{r}
print("Sleep")
sleep %>%
  select(TotalSleepRecords,
  TotalMinutesAsleep) %>%
  summary()

print("Weight")
weight %>%
  select(WeightKg,
         Fat,
         BMI) %>%
  summary()

print("Hourly calories")
hourly_calories %>%
  select(Calories) %>%
  summary()

print("Hourly intensities")
hourly_intensities %>%
  select(AverageIntensity,
         TotalIntensity) %>%
  summary()

```

## Data cleaning

### Unique

```{r}
n_distinct(daily_activity$Id)
n_distinct(sleep$Id)
n_distinct(weight$Id)
n_distinct(hourly_calories$Id)
n_distinct(hourly_intensities$Id)

```
We can see that we only have weight on 8 different people. So, this dataset will not give much insights.

### Duplicates

```{r}
print(paste("Activity:", sum(duplicated(daily_activity))))
print(paste("Sleep: ", sum(duplicated(sleep))))
print(paste("Calories: ", sum(duplicated(hourly_calories))))
print(paste("Intensities: ", sum(duplicated(hourly_intensities))))
```

```{r}
sleep <- sleep %>%
  distinct() %>%
  drop_na()
```

### Date and time format

Now we will create a column for date and time to be able to merge and plot on the next parts.

```{r}
# intensities
hourly_intensities$ActivityHour=as.POSIXct(hourly_intensities$ActivityHour, format="%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone())
hourly_intensities$time <- format(hourly_intensities$ActivityHour, format = "%H:%M:%S")
hourly_intensities$date <- format(hourly_intensities$ActivityHour, format = "%m/%d/%y")

# calories
hourly_calories$ActivityHour=as.POSIXct(hourly_calories$ActivityHour, format="%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone())
hourly_calories$time <- format(hourly_calories$ActivityHour, format = "%H:%M:%S")
hourly_calories$date <- format(hourly_calories$ActivityHour, format = "%m/%d/%y")

# activity
daily_activity$ActivityDate=as.POSIXct(daily_activity$ActivityDate, format="%m/%d/%Y", tz=Sys.timezone())
daily_activity$date <- format(daily_activity$ActivityDate, format = "%m/%d/%y")

# sleep
sleep$date <- format(sleep$SleepDay, format = "%m/%d/%y")

```
```{r}
subset(daily_activity, select = -c(Id, TotalSteps, Calories, SedentaryMinutes))
```

```{r}
daily_activity_long <- melt(
  select(daily_activity, Id, ActivityDate, TotalDistance, VeryActiveDistance, ModeratelyActiveDistance, LightActiveDistance, SedentaryActiveDistance),
  id = c("Id", "ActivityDate")
)

daily_activity_long %>%
  ggplot(aes(x= variable, y = value)) +
  geom_boxplot(fill = "lightblue",
               outlier.shape = 1,
               outlier.size = 2) +
  theme_bw()
```

```{r}
daily_activity_long <- melt(
  select(daily_activity, Id, ActivityDate, VeryActiveMinutes, FairlyActiveMinutes, LightlyActiveMinutes, SedentaryMinutes),
  id = c("Id", "ActivityDate")
)

daily_activity_long %>%
  ggplot(aes(x= variable, y = value)) +
  geom_boxplot(fill = "lightblue",
               outlier.shape = 1,
               outlier.size = 2) +
  theme_bw()
```

## Plots

### Activity

```{r}
ggarrange(
  ggplot(daily_activity, mapping = aes(x = TotalSteps, y = Calories)) + geom_point() + geom_smooth(),
  ggplot(daily_activity, mapping = aes(x = SedentaryMinutes, y = Calories)) + geom_point() + geom_smooth(),
  ggplot(daily_activity, mapping = aes(x = TotalDistance, y = Calories)) + geom_point() + geom_smooth()

)

```

### Intensity and calories

Lets find how intensity and heart rate vary though the day.

```{r}
intensities_calories <- merge(hourly_intensities, hourly_calories, by=c("Id", "ActivityHour", "date", "time"))

hourly_means <- intensities_calories %>%
  group_by(time) %>%
  summarize(mean_calories = mean(Calories), mean_intensity = mean(TotalIntensity))

hourly_means
```

```{r}
calories <- hourly_means %>%
  ggplot(aes(x = time)) +
  geom_point(aes(y = mean_calories), size = 1.5) +
  scale_y_continuous(breaks = seq(0, 150, 50)) +
  coord_cartesian(ylim = c(0, 150)) +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(x = "Hour of Day", y = "Calories", color = "Metric", title = "Average Calories Over Time")

intensity <- hourly_means %>%
  ggplot(aes(x = time)) +
  geom_point(aes(y = mean_intensity * 100), size = 1.5) +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(x = "Hour of Day", y = "Intensity", color = "Metric", title = "Average Intensity Over Time")

calories + intensity
```


###  Sleep data

```{r}
sleep <- sleep %>% 
  mutate(TotalTimeNotAsleep = TotalTimeInBed - TotalMinutesAsleep)
```

```{r}
# Create a histogram of total minutes asleep
ggplot(sleep, aes(x = TotalMinutesAsleep)) +
  geom_histogram(binwidth = 45, fill = "skyblue", color = "black") +
  labs(x = "Total Minutes Asleep", y = "Frequency", title = "Distribution of Total Minutes Asleep")
```

```{r}
ggplot(sleep, aes(x = TotalMinutesAsleep, y = TotalTimeInBed)) +
  geom_point(color = "skyblue") +
  labs(x = "Total Minutes Asleep", y = "Time in bed", title = "Total Minutes Asleep vs. Total Time in Bed")
```

```{r}
# Calculate average sleep duration per night
average_sleep <- sleep %>%
  group_by(Id) %>%
  summarize(AverageMinutesAsleep = mean(TotalMinutesAsleep))

# Create a bar plot of average sleep duration per night
ggplot(average_sleep, aes(x = factor(Id), y = AverageMinutesAsleep)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(x = "ID", y = "Average Minutes Asleep", title = "Average Sleep Duration per Night") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

```{r}
# Convert SleepDay to Date format
sleep$SleepDay <- as.Date(sleep$SleepDay, format = "%m/%d/%Y")

# Create a line plot of Total Sleep Records over time
ggplot(sleep, aes(x = SleepDay, y = TotalSleepRecords)) +
  geom_point() +
  labs(x = "Date", y = "Total Sleep Records", title = "Total Sleep Records Over Time")

```



### Weight

```{r}
# Convert the date variable to a Date object
weight$Date <- as.Date(weight$Date, format = "%m/%d/%Y %H:%M:%S")

ggplot(weight, aes(x = Date, y = WeightKg)) +
  geom_point() +
  facet_wrap(~ Id, scales = "free")
  labs(x = "Date", y = "Weight (Kg)", title = "Weight Trend Over Time")

```
